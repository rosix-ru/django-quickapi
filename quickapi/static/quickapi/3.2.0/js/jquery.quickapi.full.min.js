(function(a){a.quickAPI=function(d){var f,b=d||new Object();if(!b.data){b.data=b.args||{method:"quickapi.test"}}if(b.simple_request){f=b.data;if(!f.language){f.language=b.language||window.LANGUAGE_CODE}}else{f={jsonData:a.toJSON(b.data),language:b.language||window.LANGUAGE_CODE}}var g,c={type:b.type||"POST",async:b.sync===true?false:b.async===false?false:true,timeout:b.timeout||window.AJAX_TIMEOUT||3000,url:b.url||window.QUICKAPI_URL||"/api/",data:f,dataType:"json",},h=b.callback||function(j,i,k){},e=b.handlerShowAlert||window.handlerShowAlert||function(l,m,j,i){var k;if(a.type(m)=="object"){m=a.toJSON(m).replace(/\,\"/g,', "').replace(/\"\:/g,'": ')}else{if(m.match(/<\!DOCTYPE/)){k=m.match(/<[title,TITLE]+>(.*)<\/[title,TITLE]+>/);if(k){l=k[1]}k=m.match(/<[body,BODY]+>([^+]*)<\/[body,BODY]+>/);if(k){m=k[1].replace(/<\/?[^>]+>/g,"").replace(/ [ ]+/g," ").replace(/\n[\n]+/g,"\n")}}}if(m.length>512){m=m.substring(0,512)+" ..."}alert(l+"\n"+m);if(i){return i()}return null};g=a.ajax(c).fail(function(k,i,j){if(k.getResponseHeader("Location")){location.replace(k.getResponseHeader("Location"))}else{if(k.responseText){console.error("ERROR:",k.responseText);e("ERROR:",k.responseText,"alert-danger")}}}).done(function(j,i,l){if(b.log&&window.DEBUG){console.debug(b.log)}if((j.status>=300)&&(j.status<400)&&(j.data.Location!=undefined)){var k=j.data.Location,m;m=function(){location.replace(k)};console.info("REDIRECT:"+k);if(j.message){e("REDIRECT:",j.message,"alert-danger",m)}else{m()}}else{if(j.status>=400){e("ERROR:",j.message,"alert-danger")}else{if(window.DEBUG){console.debug(a.toJSON(j.message));if(b.data.method=="quickapi.test"){console.debug(j.data)}}return h(j,i,l)}}});return g}}(jQuery));(function(b){var a="quickTable";b.fn[a]=function(c){if(!this.size()){console.error("The selector found nothing");return undefined}if((!c.url&&!window.QUICKAPI_URL)||!c.method){console.error("Not valid options for "+a,{url:c.url,method:c.method,QUICKAPI_URL:window.QUICKAPI_URL})}if(b.type(c.columns)!="array"||b.isEmptyObject(c.columns)){console.error("Not valid options for "+a,{columns:c.columns},"columns must be not empty array!");console.info("EXAMPLE:\n",'columns = [ {name:"id", hidden:true, notmanaged:true}, {name:"name", title:"Name"} ]\n',"where `name` - object attribute, `hidden` - hidden column,"," `notmanaged` - the column is not managed, `title` - title of column.")}var e=this[0],f,d;f=b(e).attr("id");if(!f){return this}d=b.extend({url:window.QUICKAPI_URL,method:undefined,columns:undefined,type:"POST",timeout:10000,async:true,autoload:true,autorender_settings:true,delay:500,page:1,limit:25,limit_list:[25,50,75,100],filters:{},ordering:[],multiordering:false,table_type:"table",text_pager_prev:"&laquo;",text_pager_next:"&raquo;",_selector_filtering:"[data-filtering="+f+"]",_selector_ordering:"#"+f+" th[class^=sorting][name]",_selector_limiting:"input[data-limiting="+f+"]:checked, select[data-limiting="+f+"]",_selector_colswitcher:"input[data-colswitcher="+f+"]",_selector_settings:"#"+f+"_settings",_selector_pager:"#"+f+"_pager",_selector_pager_links:"#"+f+"_pager li:not(.disabled) a:not(.disabled)",_selector_info:"#"+f+"_info",_selector_thead:"#"+f+" thead",_selector_tbody:"#"+f+" tbody",_selector_alert_not_found:"[data-notfound="+f+"]",_default_filter_key:"_search_",_managed_columns:[],_column_names:{},},c);e.opts=d;e.request=null;e.fn={};d.replace=true;b.each(d.columns,function(h,g){d._column_names[g.name]=g;if(g.hidden){b(e).addClass("table-col-"+(h+1)+"-hidden")}});e.fn.delay=(function(){var g=0;return function(i,h){clearTimeout(g);g=setTimeout(i,h)}})();e.fn._render_bs_stack=function(i,h){var j=d._selector_pager,g=d._selector_pager_links;if(i<h){b(g).data("page",(i+1));b(j).show()}else{b(g).data("page","");b(j).hide()}};e.fn._render_bs_pager=function(k,j,h){var i="",l=d.text_pager_prev,g=d.text_pager_next;if(k>1&&!h){i+='<li><a href="#" data-page="'+(k-1)+'">'+l+"</a></li>"}else{i+='<li class="disabled"><span>'+l+"</span></li>"}if(k<j){i+='<li><a href="#" data-page="'+(k+1)+'">'+g+"</a></li>"}else{i+='<li class="disabled"><span>'+g+"</span></li>"}b(d._selector_pager).html(i)};e.fn._render_bs_pagination=function(n,m,k,l){var j="",k=k||3,l=l||2,h=".",i=[],g;if(n>1){j+='<li><a href="#" data-page="'+(n-1)+'">'+d.text_pager_prev+"</a></li>"}else{j+='<li class="disabled"><span>'+d.text_pager_prev+"</span></li>"}g=function(p,q){for(var o=p;o<q;o++){i.push(o)}};if(m>9){if(n>(k+l)){g(1,k);i.push(h);g(n+1-k,n+1)}else{g(1,n+1)}if(n<(m-k-l+1)){g(n+1,n+k);i.push(h);g(m-l+1,m+1)}else{g(n+1,m+1)}}else{i=b.map(b(Array(m)),function(p,o){return o+1})}b.each(i,function(o,p){if(p==h){j+='<li class="disabled"><span>...</span></li>'}else{if(p==n){j+='<li class="active"><span>'+n+"</span></li>"}else{j+='<li><a href="#" data-page="'+p+'">'+p+"</a></li>"}}});if(n<m){j+='<li><a href="#" data-page="'+(n+1)+'">'+d.text_pager_next+"</a></li>"}else{j+='<li class="disabled"><span>'+d.text_pager_next+"</span></li>"}b(d._selector_pager).html(j)};e.fn.render_pager=function(h,g){if(d.table_type=="stack"){return e.fn._render_bs_stack(h,g)}else{if(d.table_type=="pager"){return e.fn._render_bs_pager(h,g,true)}}return e.fn._render_bs_pagination(h,g)};e.fn.alert_not_found=function(g){var h=b(d._selector_alert_not_found);g?h.show():h.hide()};e.fn.render_info=function(g){b(d._selector_info).html(g)};e.fn.render_settings=function(){var g="";b.each(d.columns,function(j,h){if(!h.notmanaged){g+='<label><input type="checkbox" name="'+f+'_colswitcher" value="'+(j+1)+'" '+(!h.hidden?" checked":"")+"/>"+(h.title||h.name)+"</label>"}});g+='<div class="btn-group" data-toggle="buttons">';b.each(d.limit_list,function(j,h){g+='<label class="btn'+(d.limit==h?" active":"")+'"><input type="checkbox" name="'+f+'_limit" '+(d.limit==h?" checked":"")+">"+h+"</label>"});g+="</div>";b(d._selector_settings).html(g)};e.fn.get_class_tr=function(g){return g?"":"danger"};e.fn.render_object=function(h,g){if(g==null){return}var i="";i+='<tr class="'+e.fn.get_class_tr(g)+'">';b.each(d.columns,function(k,j){i+="<td>"+g[j.name]+"</td>"});i+="</tr>";b(d._selector_tbody).append(i)};e.fn.render=function(h,g){var i=h.data;if(g){b(d._selector_tbody).html("")}if(b.isEmptyObject(i.objects)){e.fn.alert_not_found(true)}else{e.fn.alert_not_found(false);b.each(i.objects,function(j,k){e.fn.render_object(j,k)})}e.fn.render_pager(i.page,i.num_pages);if(i.info){e.fn.render_info(i.info)}};e.fn.get=function(i){var g=d.replace,h=i||{};if(e.request){e.request.abort()}e.request=b.quickAPI({url:d.url,timeout:d.timeout,type:d.type,async:d.async,args:{method:d.method,kwargs:{filters:b.extend({},d.filters,h),ordering:d.ordering,page:d.page,limit:d.limit,},},callback:function(k,j,l){return e.fn.render(k,g)},showAlert:d.showAlert,}).always(function(){e.request=null});return e.request};e.fn.get_first_page=function(g){d.page=1;d.replace=true;return e.fn.get(g)};b("body").off("keyup",d._selector_filtering).on("keyup",d._selector_filtering,function(j){var k=this.name||d._default_filter_key,h=d.filters[k],i=Number(b(this).data("minimum"))||0,g=this.value.length;if(this.value!=h&&(!g||g>=i)){d.filters[k]=this.value;e.fn.delay(e.fn.get_first_page,d.delay)}}).off("change",d._selector_limiting).on("change",d._selector_limiting,function(g){d.limit=this.value;e.fn.get_first_page()}).off("change",d._selector_colswitcher).on("change",d._selector_colswitcher,function(h){var i=this.value,g="table-col-"+i+"-hidden";if(!i){return}if(this.checked){b(e).removeClass(g);d.columns[i-1].hidden=false}else{b(e).addClass(g);d.columns[i-1].hidden=true}}).off("click",d._selector_ordering).on("click",d._selector_ordering,function(k){var j=b(this).attr("name"),g,h;if(!j){return}g=d.ordering;h=b.inArray(j,g);if(!d.multiordering){b(d._selector_ordering).removeClass("sorting-asc").removeClass("sorting-desc").addClass("sorting")}if(h>-1){if(!d.multiordering){g=["-"+j]}else{g[h]="-"+j}b(this).removeClass("sorting").addClass("sorting-desc")}else{h=b.inArray("-"+j,g);if(h>-1){if(!d.multiordering){g=[]}else{g=g.slice(0,h).concat(g.slice(h+1))}b(this).removeClass("sorting-desc").addClass("sorting")}}if(h==-1){if(!d.multiordering){g=[j]}else{g.push(j)}b(this).removeClass("sorting").addClass("sorting-asc")}d.ordering=g;e.fn.get_first_page()}).off("click",d._selector_pager_links).on("click",d._selector_pager_links,function(g){g.preventDefault();d.page=b(this).data("page");if(d.table_type=="stack"){d.replace=false}e.fn.get()});if(d.autorender_settings){e.fn.render_settings()}if(d.autoload){e.fn.get_first_page()}return e}}(jQuery));